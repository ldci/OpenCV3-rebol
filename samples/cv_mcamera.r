#! /usr/local/bin/rebolREBOL [	Title:		"OpenCV Tests: Image Movement"	Author:		"François Jouen"	Rights:		"Copyright (c) 2012-2014 François Jouen. All rights reserved."	License:    "BSD-3 - https://github.com/dockimbel/Red/blob/master/BSD-3-License.txt"]do %../opencv.rset 'appDir what-dir {Collins, R., Lipton, A., Kanade, T., Fijiyoshi, H., Duggins, D., Tsin, Y., Tolliver, D., Enomoto,N., Hasegawa, O., Burt, P., Wixson, L.: A system for video surveillance and monitoring. Tech.rep., Carnegie Mellon University, Pittsburg, PA (2000)}wName: "Webcam Movement Detection [q to Quit]"cvNamedWindow wName CV_WINDOW_AUTOSIZE 	capture: cvCreateCameraCapture CV_CAP_ANYkey:  #"q"; 113 as integer!foo: 0camSize: 640x480	;160x120; 320x240;640x480; 800x600;cvResizeWindow wName 640 480			; resizecvMoveWindow wName  300 300size: 640 * 480cvSetCaptureProperty capture 3 to-decimal first camSizecvSetCaptureProperty capture 4 to-decimal second camSizeimage: cvQueryFrame captureimgStruct: getPointerValues image IplImage!d1: cvCreateImage imgStruct/width imgStruct/height 8 1d2: cvCreateImage imgStruct/width imgStruct/height 8 1r1: cvCreateImage imgStruct/width imgStruct/height 8 1prevImage: cvCreateImage imgStruct/width imgStruct/height 8 1currImage: cvCreateImage imgStruct/width imgStruct/height 8 1nextImage: cvCreateImage imgStruct/width imgStruct/height 8 1cvCvtColor image prevImage CV_RGB2GRAYcvCvtColor image currImage CV_RGB2GRAYcvCvtColor image nextImage CV_RGB2GRAY; repeat until q keypresswhile [foo <> 113] [				cvAbsdiff prevImage currImage d1		cvAbsdiff currImage nextImage d2		cvAnd d1 d2 r1 0		cvThreshold r1 r1 35.0 255.0 CV_THRESH_BINARY        cvShowImage wName  r1   				; show frame        motion: cvCountNonZero r1        nonMotion: size - motion        print  ["mouvement " motion ]        ;print cvMean r1 0  ;pas en R2 mais en R3        prevImage: cvcloneImage currImage        currImage: cvcloneImage nextImage        image: cvQueryFrame capture        cvCvtColor image nextImage CV_RGB2GRAY        foo: cvWaitKey 1]print "Done. Any key to quit" cvWaitKey 0; releases structures and windowscvDestroyAllWindowsfree-mem image free-mem capturefreeDylib