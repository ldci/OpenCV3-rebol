#! /usr/local/bin/rebolrebol []do %../../opencv.r; OpenCV wants 16-bit word for decimal values in matrices !; return binaryto16bit: func [value [decimal!] /local ret n d i] [	ret: to-binary value	n: length? ret	d: 8 - n	for i 1 d 1 [append ret #0]	ret]get2D: func [arr y x /local wSize address s0 s1 s2 s3] [	arrS: getPointerValues arr CvMat!	wSize: arrS/step / arrS/cols	offset: (arrS/step * y)  + (x * wSize)	address: arrS/data + offset	s3: "0.0"	s2: "0.0"	s1: "0.0"	s0: to-decimal to-string trim get-memory address 8	reduce [s0 s1 s2 s3]]; A savoir ;Comme dans les matrices on a une union (char.. double), l'offset = 8;c'est à dire size: mat/step / mat/cols; la taille maximale est également de 8 bits; les données sont alignées avec des 0 ; pour récupérer un entier ou un réel se déplacer de 8 bits et recupérer 8 bits; appliquer un trim ; MATRICES 2-Dprint sizeof 'integer!print sizeof 'decimal!; note arr: array [2 2] : tableau 2 lignes X 2 col;cree une mat 2 rows 2 cols et reserve la mémoire pour des réélsPrint "Create a 2x2 float matrice with cvCreateMat"; only for CV_32FC1 or CV_64FC1 type matrices; OK pour CV_64FC1mat1: cvCreateMat 2 2  CV_64FC1 			print ["Is matrice?: " CV_IS_MAT mat1 ]print ["Is mask Array: " CV_IS_MASK_ARR Mat1]print ["mat/rows XOR mat/cols = 1 :" CV_IS_MAT_CONST mat1];print ["Depth: " cvCvToIplDepth CV_64FC1] ; pbs cvZero mat1								;met la matrice à 0 avant le cvmset ligne par lignecvmSet mat1 0 0  10.0						;row 0 col 0cvmSet mat1 0 1  100.0						;row 0 col 1cvmSet mat1 1 0  1000.0						;row 1 col 0cvmSet mat1 1 1  10000.0 				    ;row 1 col 1; lecture directe de la mémoire; notre matrice contient de float : donc la taille est 8mat1S: getPointerValues mat1 CvMat!address: mat1S/data							; data addressstep: mat1S/step							; row offset size: mat1S/cols * mat1S/rowsprint ["Direct data reading at address : "  mat1S/data]print get-memory address 32 for i 1 size 1 [	print to-decimal to-string trim  get-memory address 8	address: address + 8]print "Test get 2D"print get2D mat1 0 0print get2D mat1 0 1print get2D mat1 1 0print get2D mat1 1 1; second test cvmGetprint "Now reading data with cvmGet"print to-decimal cvmGet mat1 0 0 		;row 0 col 0print to-decimal cvmGet mat1 0 1		;row 0 col 1print to-decimal cvmGet mat1 1 0		;row 1 col 0	print to-decimal cvmGet mat1 1 1		;row 1 col 1;third test CV_MAT_ELEMprint "Now with CV_MAT_ELEM"print ["0x0" CV_MAT_ELEM mat1 CV_64FC1 0 0 ]print ["0x1" CV_MAT_ELEM mat1 CV_64FC1 0 1 ]print ["1x1" CV_MAT_ELEM mat1 CV_64FC1 1 0 ]print ["1x1" CV_MAT_ELEM mat1 CV_64FC1 1 1 ]print "Now with cvPtr2D"v: cvPtr2D mat1 0 0 none print to-decimal to-string trim get-memory v 8v: cvPtr2D mat1 0 1 none print to-decimal to-string trim get-memory v 8	v: cvPtr2D mat1 1 0 none print to-decimal to-string trim get-memory v 8v: cvPtr2D mat1 1 1 none print to-decimal to-string trim get-memory v 8; test matrice integersPrint "Create a 2x2 integer matrice with cvCreateMat"mat1: cvCreateMat 2 2 CV_32SC2  			mat1S: getPointerValues mat1 CvMat!size: mat1S/cols * mat1S/rowscvZero mat1								;met la matrice à 0 avant le cvmset ligne par lignecvmSet mat1 0 0 10						;row 0 col 0cvmSet mat1 0 1 200						;row 0 col 1cvmSet mat1 1 0 300 					;row 1 col 0cvmSet mat1 1 1 99999999				;row 1 col 1address: mat1S/data							; data addressstep: mat1S/step							; row offset print ["Direct data reading at address : "  mat1S/data]for i 1 size 1 [	print to-integer to-string trim get-memory address 8	address: address + 8]; second test cvmGetprint "Now reading data with cvmGet"print cvmGet mat1 0 0 		;row 0 col 0print cvmGet mat1 0 1		;row 0 col 1print cvmGet mat1 1 0		;row 1 col 0	print cvmGet mat1 1 1		;row 1 col 1print "Now with CV_MAT_ELEM"print ["0x0" CV_MAT_ELEM mat1 CV_32SC2 0 0 ]print ["0x1" CV_MAT_ELEM mat1 CV_32SC2 0 1 ]print ["1x1" CV_MAT_ELEM mat1 CV_32SC2 1 0 ]print ["1x1" CV_MAT_ELEM mat1 CV_32SC2 1 1 ]print "Now with cvPtr2D"v: cvPtr2D mat1 0 0 none print to-integer to-string trim get-memory v 8v: cvPtr2D mat1 0 1 none print to-integer to-string trim get-memory v 8	v: cvPtr2D mat1 1 0 none print to-integer to-string trim get-memory v 8v: cvPtr2D mat1 1 1 none print to-integer to-string trim get-memory v 8free-mem mat1print "done"